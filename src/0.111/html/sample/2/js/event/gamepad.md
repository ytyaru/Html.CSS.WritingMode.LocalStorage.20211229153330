# ゲームパッドについて

　[GamePad API][]で制御できる。

[GamePad API]:https://developer.mozilla.org/ja/docs/Web/API/Gamepad_API/Using_the_Gamepad_API

　ただし製品ごとにボタン数や配列が異なるため、共通コードによる制御ができない。よって製品ごとに専用のマッピングコードを書く必要がある。

　ゲームパッドを使うには、ゲームパッド製品ごとの仕様データが必要である。

## Logitech Logitech Dual Action (STANDARD GAMEPAD Vendor: 046d Product: c216)

　私が持っていたゲームパッドの情報は以下。

```javascript
window.addEventListener('DOMContentLoaded', function(e) {
    console.log(
        event.gamepad.index,          // ゲームパッド配列の添字
        event.gamepad.id,             // ゲームパッド識別子
        event.gamepad.buttons.length, // ボタン配列
        event.gamepad.axes.length);   // スティック配列
});
```
```
0
Logitech Logitech Dual Action (STANDARD GAMEPAD Vendor: 046d Product: c216)
16
4
```

　企業名はロジテック。製品名はロジテック デュアル アクション。実機のシールをみるとPIDは`VV020`であり`c216`ではない。

　16ボタン, 4軸（2スティックあり、2軸で1スティックを表す）。

　ボタンは`pushed`の真偽値、軸は0.0〜1.0で傾き度合いをもつ。


上面図
```
　⑦　　　　　　　⑧
　⑤　　　　　　　⑥
　　　┴　　　┴
```
正面図
```
　▲　　⑨⑩　　④
◀　▶　Ｍ．　①　③
　▼　　　　　　②

　　　Ⓛ　　Ⓡ
```

　上面図はいわゆるL1,L2,R1,R2キー。⑤⑥⑦⑧。左右それぞれの人差指と中指で押す。

　正面図の左にはいわゆる十字キー。左手の親指で押す。ふつう左スティックと十字キーは同時に押せない。

　正面図の右にはメインボタン。①②③④。A,B,X,Y。○,☓,△,□。右手の親指で押す。ふつう右スティックとメインボタンは同時に押せない。

　正面図の中央にはサブボタン。⑨⑩Ｍ。いわゆるSELECT,STARTボタンである。それと下にMODEがある。MODEの隣には赤LEDがある。MODEボタンは十字キーと左スティックの入替。ONにしてLED点灯したときに十字キーを押すと左スティック入力になる。おなじく左スティック入力すると十字キー入力になる。

　正面図の中央下にはスティックがある。ⓁⓇ。おもに3D空間を移動したり、アクセルの加速度を入力する。4軸あり傾斜を0.0〜1.0の範囲で入力できるため、細かい角度や加速度を入力できる。

物理キー|index|API
--------|-----|---
▲|12
▼|13
◀|14
▶|15
①|2
②|0
③|1
④|3
⑤|4
⑥|5
⑦|6
⑧|7
⑨|8
⑩|9
左棒|10
右棒|11
Ｍ|-

　メインボタンについては実機のボタンに印字されていたものと全然ちがう。番号はおろか、順序さえもちがう。これはひどい。

　十字キーも一括してボタンに含まれてしまうため、わかりにくい。

　左スティックと右スティックは押し込みすることでそれぞれボタンとして機能する。重くて押しづらい。

　MODEボタンは検知できなかった。ハードウェア専用ボタンだと思われる。

```javascript
if (pad.buttons[12].pushed) {} // 上キーが押された
```

物理軸|index|value
--------|-----|-----
左棒左|0|`-`
左棒右|0|`+`
左棒上|1|`-`
左棒下|1|`+`
右棒左|2|`-`
右棒右|2|`+`
右棒上|3|`-`
右棒下|3|`+`

　軸のvalueは`0.0`〜`1.0`と、`0.0`〜`-1.0`の２方向がある。

## 一般的なゲームパッドのボタンと配置

上面図
```
　⑦　　　　　　　⑧
　⑤　　　　　　　⑥
　　　┴　　　┴
```
正面図
```
　▲　　⑨⑩　　④
◀　▶　Ｍ．　①　③
　▼　　　　　　②

　　　Ⓛ　　Ⓡ
```
背面図
```
　　　　Ⓩ
```

　十字キーとⓁスティックの位置が入れ替わっている製品がある。

　背面にもボタンがある場合がある。

　メインボタンは①〜④でなく①〜⑥の場合がある。格ゲー仕様。弱、中、強×手、足＝６。

　大抵はキリのよい16個である。十字キー4＋メイン4＋上面+4＋中央2＋棒2。

　スティックは２本ある。Ⓛはキャラ移動用でX,Z軸。Ⓡはカメラ用でキャラ中心にズームとY軸パン。Ⓛ押し込みで目標地点の方角を向く。Ⓡ押し込みでキャラが向いている方角とおなじ方向にカメラを向ける。

## ゲームパッドの機能

* 十字キー
* ボタン
    * トグルボタン
* スティック
* タッチパネル
* バイブレータ
* ジャイロ（本体傾き）
* 3D加速度センサー
* バックライト
* 有線／無線
* マイク
* イヤホンジャック
* トラックボール

　ほかにもダイアルを回すジョグ、つまみなどのUIがある。ただしそれらがゲームパッドとして実装されていることは見たことがない。

　さらにカメラで人体の動きをキャッチするモーションキャプチャ入力もある。もはやゲームパッドではないが、そうした入力方法もある。

　トラックボールがあればマウス不要になるのだが。

https://watchmono.com/blog-entry-2349.html

## ライブラリ

https://kallaspriit.github.io/HTML5-JavaScript-Gamepad-Controller-Library/
https://github.com/alvaromontoro/gamecontroller.js/

