# 0.36 現在ページ位置をp要素位置換算する（バグ修正：スクロール途中でWritingModeを変更したら先頭に戻ってしまう問題）

## 必要箇所

* WritingMode変更時に同じ箇所を表示する
* 前回終了時復元
* 栞（bookmark）

## 方法

1. `WritingMode`変更時、`unload`時、栞を挟む／開くときに以下を実行する
2. HTML文書全体から`p`要素一覧を取得する
3. 2の要素にidを付与する:`p-${index}`
4. 画面先頭にある`p`要素の`index`を取得する:`const headElement = document.elementFromPoint(x,y)`
5. 4の要素の`id`属性値を取得する: `const headElementId = headElement.getAttribute('id')`
6. `WritingMode`変更時なら変更する。`unload`時や栞を挟むなら`localStorage.setItem`する。
7. 4の要素へスクロールする: `document.querySelector(`#${headElementId}`).scrollIntoView(true)`


