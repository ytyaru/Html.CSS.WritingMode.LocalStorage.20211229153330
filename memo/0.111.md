# 0.111

　SPAサイトにする。

　本当はページごとに別HTMLにしたかったが、わずかしか違わず同じソースコードを何度もロードすることになってしまうので、SPA（Single Page Application）にしたほうがUX的に良いと判断した。

　いずれPWAにしたい。ソースコードをローカルキャッシュしてリロード回数をさらに減らしたいから。これでネット通信におけるレスポンスの遅さをだいぶ改善できるはず。また、ホーム画面からすぐに起動できるようにすればアクセスしやすくなる。

　問題はSEO。静的HTMLしかクロールされないと検索エンジンにヒットしなくなってしまう。そこで、SPAページ以外にも作品個別にランディング用の静的HTMLを作成する。一部だけ動的にする。すなわち本文へのリンクと目次である。本文へのリンクは、一話、続き、指定話、の三種類を動的に増やせるようにする。一話は固定だが、『続き』はローカル保存された読了位置を、指定話はURLクエリから指定位置を取得する。個別作品用RSSがあってもいいかもしれない。

　アプリにするなら以下の二つに分離する。

* 読む（本棚）
* 書く（書斎）

　とりあえず読むSPAをつくる。おおまかに以下の三ページに分かれる。

* index.html（作品一覧）
* guide.html（サイト機能紹介）
* policy.html（サイトポリシー）
* author.html（著者紹介）
* cover.html（作品メタ情報。外部サイトから紹介されたときの作品個別用ランディングページ）
* page.html
	* header（メタ情報）
	* main（本文＋捕捉情報）
	* footer（設定）

　各ページでやることは以下。

* 共通
	* データ取得(TSV)
		* 要約
			* 作品数
			* 文字数
		* 全作品
		* 自作品のみ
		* 複数
			* 順（公開／更新）
			* 単位（話／作品）
			* 絞込（完結済み）
			* 規模（掌、短、中、長）
			* 数（上位100）
* ページ作成
	* 作品一覧
	* 作品ランディング（作品をシェアするページ。OGPが静的HTMLで用意される）
	* 作品扉（章や編などの単位ではさむ。イラストや感想を求めるあとがきなど）
	* 本文
* 外部サイト
	* 中央集権
		* Twitter
		* Facebook
		* Hatena Bookmark
		* Pocket, Feedly
		* [LINE](https://developers.line.biz/ja/docs/line-social-plugins/install-guide/using-line-share-buttons/#using-official-line-icons)
		* GitHub
		* URLをコピーする、引用HTMLタグをコピーする`</>`
	* 分散
		* ActivityPub
			* Mastodon, Misskey
			* WriteFreely, Pleroma
			* Pixelfed
		* IPFS


## テンプレート

* DOCTYPE, html, head, body, main, header, footer
* meta
    * OGP（SNS用メタデータ）
* title
* base
* link
    * favicon
    * license
    * manifest（PWA用メタデータ）
    * search（OpenSearchプラグイン用メタデータ）
    * alternate（フィード）
* script
    * JSON-LD（schema.org用メタデータ。Google検索エンジン用メタデータ（サイトメニュー。パンくず。ハウツー。よくある質問。アプリ））
* Web Story（HTML）
    * https://qiita.com/r_ishimori/items/ecc72a9f4c78801ee858
* サイトマップ（sitemap.xml）
    * https://qiita.com/shotets/items/21cd7930f68cce8a0506

　メタデータの種類がたくさんある。

* HTML
    * `meta`,`link`,`title`,`base`,`script`
        * OGP(Open Graph Protocol)
        * favicon
        * license
        * manifest（json）
        * open search（xml）
        * alternate（xml(atom,rss)）
        * schema.org（JSON-LD）
    * Web Story
* XML
    * sitemap.xml




OGPジェネレータ
https://webcode.tools/generators/open-graph/article

JSON-LDジェネレータ
https://webtan.impress.co.jp/e/2019/08/05/33500

XML サイトマップと RSS/Atom フィードのベストプラクティス
https://developers.google.com/search/blog/2014/10/best-practices-for-xml-sitemaps-rssatom

* サイトマップは5万URLかつ50MB以下であること
* WebSubにプッシュして通知する

　静的／動的HTMLの長所・短所を考慮して。

https://.../index.html
https://.../search.html（index.htmlさえあればいいかも？　OpenSearch遷移先であり作品を全文検索する）
https://.../guide.html
https://.../policy.html
https://.../author.html
https://.../お知らせ.html（サイトマップ、フィード、Twitterと類似）
https://.../works/landing/1.html（book-cover.htmlの静的HTML版。外部サイトから作品を閲覧するとき最初に閲覧するページ）
https://.../works/book-cover.html?（landingページさえあればいいかも？　でも動的HTMLのほうがロードが速いし、悩ましい）
https://.../works/book-page.html?
https://.../404.html?（５秒後にルートへリダイレクトするようにするなど。GitHubPagesやNetlifyで404をカスタムできるらしい）

## マネタイズ

　オンライン決済サービス。

https://tatepro.com/codoc/#gsc.tab=0
https://tatepro.com/codoc_fee/#gsc.tab=0

　Amazonギフト券


　クラウドファウンディング

* https://community.camp-fire.jp/readyfor

　アプリ販売（Google Play, Apple Store）

　アフィリエイト

　Braveブラウザ

## セキュリティ

* [keybase][]は公開鍵基盤。SNSアカウントを管理し、改竄やなりすましを防ぐ。

[keybase]:https://keybase.io/

https://tech.degica.com/ja/2017/10/06/keybase-git/

## サーバ

Cloudflare Pages・Vercel ・Netlify の違いや使い分けをまとめる
* https://zenn.dev/catnose99/scraps/6780379210136f
* https://www.suzu6.net/posts/92-netlify-monthly/

## 作品検索

* 未（未読）
    * タイトル、ピッチ、ログライン
    * あらすじ
* 切（切捨）
    * （タイトル、ピッチ、ログライン、あらすじ、までは読んだが本文は未読。それでも「これは読まない」とマークした作品）
* 中（読書中）
    * nファイル,n段落
    * 待『最新話待ち』：未完結の作品を最新話まで読んだ状態
    * 中『読書中』：完結／未完とわず最新話まではまだ読んでいない状態
    * 離『離脱』：完結／未完とわず最新話まではまだ読んでいない状態だが「もう読まない」とマークした作品
* 済了既（既読、読了済み）
    * （最終ファイルの末尾まで読んだ）
* 応答（応答、応援、支援）
    * 紹（済紹介済み）（Twitterなど）
    * 感（感想済み）
    * レ（レビュー済み、　推薦済み）
    * 二（二次創作）
* 支払い
    * 寄付（投げ銭）、支払い、ペイメント
    * 購入済み
    * サブスクリプション
    * クラウドファウンディング

　作品に対するユーザの堪能度。ゲーミフィケーションでユーザができるアクションを提示しつつ、完成させたくさせて行動を誘発させる。

```
📕[了]             100%
✑ [紹][感][レ][二] 100%
💰[寄][買][サ]     100%
```

## 栞の記録

　どの作品をどこまで読んだか。そのデータを永続保存するためにIndexedDBを使う。ただしそのデバイスにしか存在できず異なるデバイス間で共有できない。その代わりアカウント不要である。

## 栞の共有（異なるデバイス間における）

　ユースケースとして、自宅にいるときはPC、外出先ではスマホで閲覧するが、栞は異なるデバイス間で共有したい。それを実現するためには、栞のデータをサーバにアップロードし、ダウンロードする必要がある。

　栞の共有はGitHubで行う。ユーザは各自GitHubのアカウントを取得する。SPAサイトにてGitHubアカウントでログインして小説を読むと、自動的に「Novel.Bookmark」リポジトリの「bookmark.json」を作成・更新する。つまり、各デバイスにGitHubのユーザ名とパスワードを記憶させれば、あとはアプリ側がやってくれる。

