# 0.109

* 動的にすべきか静的にすべき
* 読了
* UU/PV

## 動的にすべきか静的にすべき

　動的なら、利用者がサイトにアクセスするたびJSでテキストからHTMLに動的変換する。著者はテキストをアップロードするだけで更新できる。

　静的なら、著者がテキストを更新するたび著者のローカル環境でテキストからHTMLを生成し、それをアップロードする。読者はHTMLを閲覧するだけ。

　両者はトレードオフの関係にある。おもに次の項目において比例／反比例する。

* ファイル容量／計算コスト・実行速度

　動的ならファイル容量は減らせる。ディスクに保存すべきは小説のテキストだけであり、閲覧のために必要なHTMLは動的に生成するためだ。その代わりHTML生成には計算が必要だ。そのために電力を消費するし、時間もかかる。閲覧者が大勢いたら人数分だけ、デバイスの数だけ、閲覧する頻度だけ、おなじ計算をすることになる。全体からみたら盛大なムダである。

　静的なら計算不要である。はじめからHTMLなのでHTMLを動的生成する必要はない。ただし、共通部分が多いHTMLを保存するディスクスペースが必要になる。閲覧者が多ければその人数だけ。デバイスが多ければその数だけ増える。通信に必要な量はテキストよりHTMLのほうが多い。パケット代も増える。それは計算で消費する分の電気代より大きいかもしれない。

### 各個HTML化パターン

　著者は中間書式であるテキストをアップロードする。読者はテキストが更新されるたびに自らのデバイスでHTML化し、保存する。以降はディスクに保存されたHTMLを閲覧する。２回目以降は計算も通信もいらない。ただしテキストが更新されたら再びHTML化のために計算し、ディスクに保存されたHTMLを上書きする。ようするに更新されるたびに通信と計算が必要になる。ただし更新されないかぎりは通信も計算もせずに済む。

　HTML化はデバイスの画面サイズに応じて決定する。たとえばスマホなら一行あたり20字ほどであるという前提でフォントサイズを決める。

　テキストとHTMLの両方を保存してしまうとデータが重複してしまう。けれど更新されたか判定するための日付データだけは必要だ。それに加えてHTMLを保存することになるだろう。ただ、更新時にテキストデータがなければHTMLを作成できない。よって結局はHTMLデータをダウンロードすることになる。ディスクに保存しないとはいえ、効率が悪い。変更箇所だけをアップロードできればいいのだが、そのような手段を思いつかない。

### 動的パターン

　上記のような中途半端になるくらいなら、いっそ動的にしてしまったほうがいい気がする。テキストだけを通信し、あとは各自のデバイスで閲覧するたびにHTML化する。

## 読了

　ユーザは読了した作品を検索から除外できるようにしたい。

1. ユーザは作品Aを閲覧する
1. 作品Aの全ページを閲覧した
1. 作品Aの読了感想を書き残すことができる（ディスク保存／GitHub保存）
1. 作品検索において読了作品を除外するチェックボックスを出す

　これにてユーザはすべての作品を閲覧できる。読了率も表示したい。

* ユーザは
* どのページを
* いつ
* 読了したか

```
date               	book	page	values	review
yyyy-mm-ddTHH:MM:SS	0		0		0,1,2	面白かった。物語の展開はテンポがよく、盛り上がる見所もある。キャラの葛藤も描かれていて感情移入しやすかった。
```

## UU/PV

　Google アナリティクスによりページビューとユニークユーザ数を記録する。ただし仕様によりその期間は最大で１年間だけ。そのせいで１年以上を超えた累計のUUは計測できない。PVは計測できる。

　計測単位は以下のようにしたい。

* サイト
* 作品
* ページ

　これにて人気の作品がわかる。

## 作品トップ

タイトル
著者
[一話から読む][🔖+フォロー＜新規登録]

nnn字   完結／連載中  yyyy-mm-dd〜yyyy-mm-dd
累計PV　ジャンル　レイティング
累計UU　タグ

あらすじ
目次
レビュー


### 作品目次

単位|概要
----|----
編|同じ世界観でありつつ時代や視点が変わったもの。続編や外伝、シリーズもの。
部|舞台や主人公の年齢が大きく変わる。
巻|物理的な単位。文庫本だと10〜12万字程度。
章|起承転結のひとまとまり。
節|起承転結のうちのひとつだけ。
項|物理的な単位。ページ。WEB小説だと2〜4千字程度。

　1話あたり4千字。5話で2万字で1章としたい。1章2万字以内に小さい起承転結をつけて感想を求められるようにしたい。5章で10万字。10万字で文庫本1冊分。一旦まとめる単位としたい。

```
1部 ○○○○
 1章 ○○○○
  1話 ○○○○
  2話 ○○○○
  3話 ○○○○
  4話 ○○○○
 2章 ○○○○
  5話 ○○○○
  6話 ○○○○
  7話 ○○○○
  8話 ○○○○
```

### 作品構成

* ディレクトリ
* ファイル一覧
* 単一ファイル

#### ディレクトリ

```
* 1部
    * 1章
        * 1話.txt
        * 2話.txt
    * 2章
        * 1話.txt
```

* 次のファイルのパスを決めるには、今のディレクトリの最後のファイル番号を知る必要がある

　このディレクトリ構成のままデプロイしても次のパスが不明なままである。ローカルなら`pwd`や`ls`などのコマンドでどうにか次のパスを割り出せる。だがHTTP通信では次のリンクを明記する必要がある。それをすべて手作業でやるなどバグの元だし作業量がとんでもなく膨大になってしまう。なのでページ間リンクは自動化すべき。

　著者が小説を書くとき、最初はひとつのテキストファイルに書いていく。それを2〜4千字ごとに区切ってサブタイトルをつける。あまりにも膨大になると、その単位で別ファイル化する。
　著者が自然に章分けする方法はディレクトリとファイルによる分離である。

　どの形式でも各形式に変換できるようにすれば万全だ。ファイル作成ならSSG（静的サイトジェネレータ）のようなローカルツールにする必要がある。

　ファイル順リストを作成する。同一作品の内部構造を解析し、次のファイルへのリンクを順にリスト化する。これはディレクトリやファイル名を順にソートしたものと一致する。そのため自動化できる。

```
1/1/1.txt
1/1/2.txt
1/1/3.txt
1/2/1.txt
1/2/2.txt
1/2/3.txt
2/1/1.txt
```

#### ファイル一覧

```
* 0.txt
* 1話.txt
* 2話.txt
* 3話.txt
* 4話.txt
```

0.txt
```
begin   end level   name
1       25  1       ○○編
1       5   2       ○○章
6       10  2       ○○章
11      15  2       ○○章
16      20  2       ○○章
21      25  2       ○○章
```

#### 単一ファイル

```
# 作品タイトル

## 第○部
### 第○章
#### 第○話

　本文。

#### 第○話

　本文。

```

#### 任意設定

series.tsv
```
id  name    worksId
i   s       ai
0   ○○    0,9,100
0   △△    1,7,500
```

heading.tsv
```
level   unit    standard        description
i       s       s               s
1       編      2〜n部／編      長編。20万字〜／2部〜／編。ある主人公の物語。
2       部      4〜6章／部      中編。10万字／巻。ある舞台での物語。
3       章      4〜6話／章      短編。2万字。起承転結の単位。
4       話      2〜4千字／話    数分でサクッと読める量。400字／分。起承転結の内ひとつ。
```

headings.tsv
```
id  1       2           3           4
0   ○○編  第1部○○   第1章○○   1話○○
1                                   2話○○
2                                   3話○○
3                       第2章○○   1話○○
1                                   2話○○
2                                   3話○○
```
```
begin   end level   name
1       25  1       ○○編
1       5   2       ○○章
6       10  2       ○○章
11      15  2       ○○章
16      20  2       ○○章
21      25  2       ○○章
```




```
1-1-1-1.txt
1-1-1-2.txt
1-1-1-3.txt
```
