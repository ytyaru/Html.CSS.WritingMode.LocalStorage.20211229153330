# 0.109

* 動的にすべきか静的にすべき
* 読了
* UU/PV

## 動的にすべきか静的にすべき

　動的なら、利用者がサイトにアクセスするたびJSでテキストからHTMLに動的変換する。著者はテキストをアップロードするだけで更新できる。

　静的なら、著者がテキストを更新するたび著者のローカル環境でテキストからHTMLを生成し、それをアップロードする。読者はHTMLを閲覧するだけ。

　両者はトレードオフの関係にある。おもに次の項目において比例／反比例する。

* ファイル容量／計算コスト・実行速度

　動的ならファイル容量は減らせる。ディスクに保存すべきは小説のテキストだけであり、閲覧のために必要なHTMLは動的に生成するためだ。その代わりHTML生成には計算が必要だ。そのために電力を消費するし、時間もかかる。閲覧者が大勢いたら人数分だけ、デバイスの数だけ、閲覧する頻度だけ、おなじ計算をすることになる。全体からみたら盛大なムダである。

　静的なら計算不要である。はじめからHTMLなのでHTMLを動的生成する必要はない。ただし、共通部分が多いHTMLを保存するディスクスペースが必要になる。閲覧者が多ければその人数だけ。デバイスが多ければその数だけ増える。通信に必要な量はテキストよりHTMLのほうが多い。パケット代も増える。それは計算で消費する分の電気代より大きいかもしれない。

### 各個HTML化パターン

　著者は中間書式であるテキストをアップロードする。読者はテキストが更新されるたびに自らのデバイスでHTML化し、保存する。以降はディスクに保存されたHTMLを閲覧する。２回目以降は計算も通信もいらない。ただしテキストが更新されたら再びHTML化のために計算し、ディスクに保存されたHTMLを上書きする。ようするに更新されるたびに通信と計算が必要になる。ただし更新されないかぎりは通信も計算もせずに済む。

　HTML化はデバイスの画面サイズに応じて決定する。たとえばスマホなら一行あたり20字ほどであるという前提でフォントサイズを決める。

　テキストとHTMLの両方を保存してしまうとデータが重複してしまう。けれど更新されたか判定するための日付データだけは必要だ。それに加えてHTMLを保存することになるだろう。ただ、更新時にテキストデータがなければHTMLを作成できない。よって結局はHTMLデータをダウンロードすることになる。ディスクに保存しないとはいえ、効率が悪い。変更箇所だけをアップロードできればいいのだが、そのような手段を思いつかない。

### 動的パターン

　上記のような中途半端になるくらいなら、いっそ動的にしてしまったほうがいい気がする。テキストだけを通信し、あとは各自のデバイスで閲覧するたびにHTML化する。

## 読了

　ユーザは読了した作品を検索から除外できるようにしたい。

1. ユーザは作品Aを閲覧する
1. 作品Aの全ページを閲覧した
1. 作品Aの読了感想を書き残すことができる（ディスク保存／GitHub保存）
1. 作品検索において読了作品を除外するチェックボックスを出す

　これにてユーザはすべての作品を閲覧できる。読了率も表示したい。

## UU/PV

　Google アナリティクスによりページビューとユニークユーザ数を記録する。ただし仕様によりその期間は最大で１年間だけ。そのせいで１年以上を超えた累計のUUは計測できない。PVは計測できる。

　計測単位は以下のようにしたい。

* サイト
* 作品
* ページ

　これにて人気の作品がわかる。

