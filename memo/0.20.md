# 段組み領域を1画面サイズにしたい

　現状だと段組みは全テキスト単位で分割されてしまう。そのためスクロール末端まで読んだら、その後はスクロール先端まで戻らねばならない。その作業が段組数だけ必要である。これだと手間がかかりすぎて面倒だ。

　そこで段組みの仕方を変えたい。本と同じようにしたい。１画面サイズに含められる字数分だけ字をぶちこんで、そこを１つの段組みとする。そんなことがCSSで実現できるか不明なのでやってみる。`column-width:100%;`の状態でやればイケるかもしれない。他にも`break-after: column;`の動作を確認したい。

（`column-width:`, `width`, `height`, `column-gap`, `column-rule-width`, `break-after: column;`）

* https://developer.mozilla.org/ja/docs/Web/CSS/CSS_Columns
* https://developer.mozilla.org/ja/docs/Web/CSS/column-width

## column-width

　段組み1段あたりの領域を画面サイズと同じにする。概ね本のような表示になった。しかし次のような問題点がある。ひとことでいうなら「１画面単位での段組みができない」ということだろう。

* ページ送りが本のようにならない
    * 横書き：横スクロールのためマウスホイールでスクロールできない
    * 縦書き：縦スクロールのためマウスホイールでスクロールできるが、中途半端な位置になりぴったり次ページをすべて表示刷る位置にならない
* 見切れてしまう（ルビの部分など一部がページの前後をまたいでしまう）

縦書き
```css
    writing-mode: vertical-rl;
    text-orientation: var(--text-orientation); /* upright, sideways */

    --client-width:calc((1920 - 20) * 1px);
    --client-height:calc((1080- 80) * 1px);
    width: var(--client-width);
    height: var(--client-height);
    column-width: var(--client-width);
    column-gap: calc(var(--column-gap-px) * 1px);
    column-rule: thick inset black; /* 段組み装飾 */
```

横書き
```css
    writing-mode: horizontal-tb;
    text-orientation: var(--text-orientation); /* upright, sideways */

    --client-width:calc(1920 - 20);
    --client-height:calc(1080 - 150);
    width: calc(var(--client-width)*1px);
    height: calc(var(--client-height)*1px);
    column-width: calc((var(--client-width))*1px);
    column-gap: calc(var(--column-gap-px) * 1px);
    column-rule: thick inset black; /* 段組み装飾 */
```

　段組みの具切りはあくまでピクセル単位での領域。なのでHTML要素が見切れていようがお構いなし。ひどい。

## `break-after: column;`

　上記の失敗を踏まえ、HTML要素単位で区切りたい。けれど画面サイズ領域も考慮したい。つまりHTML要素のうち見きれずにすべて表示できている最後の要素を探し、その要素に`break-after: column;`を適用する。これにてHTML要素（パラグラフ単位）で改ページ（改段落）できるはず。

　想定されるバグとしてはレスポンスの悪化だ。上記計算をするのはかなりの負荷がかかるはず。一気にすべてやるならHTML要素数が多いほど時間がかかる。次の要素だけやるなら少なくて済むが、ページをジャンプすることができなくなる。ページジャンプしたいときにはじめて計算してもいいが、やはりレスポンスが遅いだろう。

* https://developer.mozilla.org/ja/docs/Web/CSS/break-after

### 方法

　画面サイズに応じて改ページ（改段組み）するHTML要素を見つけ出してbreak-after: column;する。

### 計算方法

1. HTML要素を先頭から順に見てゆく
2. 1を表示する幅（高さ）をCSSピクセル単位で取得する
3. 2を次々に加算してゆく
4. 3が画面サイズを超過したとき、直前の要素に対してbreak-after: column;する
5. 3の値を0に戻し、現在のHTML要素から再び1を繰り返す。これを最後の要素まで繰り返す。

### 結果

　失敗。再描画されないせい。HTMLのstyle属性値に`break-after: column;`をセットした。それはデベロッパツールで成功したことを確認した。けれど画面の表示は変わらなかった。なんでや！

　あとは`.break{break-after: column;}`のようにCSS定義し、HTML要素のclass属性値に`class="break"`としてみる。これでもダメならお手上げ。ブラウザ側実装の問題だと思われる。


